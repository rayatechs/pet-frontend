<script setup lang="ts">
import { computed, ref, reactive } from 'vue'
import { usePetStore } from '@/stores/pet'
import { IconPlus } from '@tabler/icons-vue'
import { useRoute } from 'vue-router';

interface Props {
  image?: string
}

const props = defineProps<Props>()

const route = useRoute()
const pet = usePetStore()

let avatar: File = reactive(new File([''], ''))
const uploadImageButton = ref()
const imagePreview = computed(() => props.image ?? URL.createObjectURL(avatar))

function preview(e: any) {
  avatar = e.target.files[0]

  pet.storeAvatar(Number(route.params.id), avatar)
}
</script>

<template>
  <div class="flex border-[3px] border-red-200 rounded-full bg-red-50 relative">
    <img v-if="image != '' || avatar.name != ''" class="w-32 h-32 rounded-full" :src="imagePreview" />

    <svg
      v-else-if="pet.type == 'cat'"
      class="w-16 h-16 m-8"
      width="72"
      height="75"
      viewBox="0 0 72 75"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        class="fill-red-200"
        d="M26.2443 66.4183C24.1419 65.3278 22.5582 63.9151 21.2827 62.0035C21.1667 62.2762 21.0752 62.4652 21.0019 62.6603C19.8454 65.7708 18.692 68.8813 17.5355 71.9917C16.8214 73.9094 15.6802 74.7397 13.6754 74.7645C12.0489 74.7831 10.4195 74.7893 8.79304 74.7614C6.64786 74.7273 5.14044 73.4819 4.76511 71.4805C4.42639 69.6744 5.43643 67.9456 7.31003 67.1247C7.33444 67.1154 7.3558 67.0999 7.38021 67.0937C9.858 66.567 11.1488 64.9498 11.6004 62.4837C11.7438 61.7061 12.0612 60.9564 12.3541 60.216C13.2146 58.0535 12.9491 55.9716 11.9757 53.9331C11.3746 52.6691 10.6483 51.4639 9.6505 50.5066C7.73723 48.6664 6.81874 46.3242 6.17488 43.8365C5.25334 40.2768 5.40286 36.7388 6.5258 33.2349C6.67837 32.7547 6.92249 32.3612 7.25815 31.9926C8.54282 30.586 9.27517 28.9255 9.47962 27.0109C9.54065 26.4346 9.37892 26.3386 8.84186 26.3634C5.33878 26.5121 1.90589 24.4116 0.563245 21.3507C0.325231 20.8054 0.154349 20.2447 0.0567019 19.653C-0.202672 18.0605 0.435083 16.6602 1.82045 15.8609C3.32482 14.9935 4.31349 13.8534 4.65525 12.0007C5.32963 8.3512 7.93252 6.46447 11.1671 5.2996C12.1649 4.94022 12.1802 4.96191 12.0032 3.90237C11.875 3.13405 11.576 2.42459 11.2037 1.74302C10.6666 0.760928 11.1457 -0.072452 12.2381 0.00499972C15.7595 0.252845 18.4662 1.75541 19.8119 5.25313C19.9065 5.49478 19.995 5.70854 20.2574 5.83556C25.3838 8.27684 28.0539 12.642 29.4331 17.9893C31.1572 24.6625 35.0204 29.638 40.9585 32.9282C42.6185 33.8483 44.2236 34.818 45.6547 36.0696C50.0854 39.9453 52.4228 44.8062 52.3893 50.7885C52.371 53.9888 52.3832 57.1922 52.3923 60.3925C52.3923 60.659 52.2397 61.0277 52.5144 61.1702C52.7402 61.2879 52.9538 60.9781 53.1521 60.8325C60.3871 55.4697 63.8384 48.2264 63.3928 39.1584C63.1152 33.4641 60.7167 28.5847 57.2747 24.1823C56.8169 23.5968 56.3196 23.0391 56.1243 22.2863C55.7367 20.7899 56.3684 19.2688 57.6897 18.5129C59.0201 17.7538 60.6557 17.98 61.7542 19.1232C64.0581 21.5242 65.9713 24.2164 67.4971 27.1875C69.5507 31.1902 70.8506 35.4314 71.2137 39.9329C71.6379 45.1965 70.5912 50.1937 68.3515 54.9461C65.596 60.7953 62.0533 66.0341 56.8688 69.9532C53.8265 72.252 50.5187 74.0333 46.7319 74.7366C45.5509 74.9566 44.3578 75.0216 43.1617 74.9783C37.3151 74.78 31.4654 74.9318 25.6188 74.8822C25.0848 74.8791 24.5508 74.8791 24.029 74.7366C22.0883 74.2037 20.8341 72.41 20.9836 70.3807C21.1301 68.3918 22.6558 66.8458 24.7034 66.6104C25.158 66.5701 25.6005 66.505 26.2443 66.4183ZM10.8009 11.5577C9.7573 11.5515 9.22635 11.8489 8.95782 12.5894C8.67403 13.3763 9.06157 14.2499 9.83053 14.5535C10.987 15.012 12.3083 14.5814 12.647 13.6365C13.0681 12.4747 12.2625 11.567 10.8009 11.5577Z"
        fill="#DADADA"
      />
    </svg>

    <svg
      v-else
      class="w-16 h-16 m-8"
      width="73"
      height="75"
      viewBox="0 0 73 75"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        class="fill-red-200"
        d="M20.8357 71.4284C19.8368 70.4118 18.9462 69.3572 18.2431 68.159C16.7578 65.6221 16.0401 62.8508 15.8028 59.9564C15.1027 51.496 18.1552 44.433 23.9937 38.4685C27.7054 34.6777 32.1671 32.1027 37.2615 30.6379C37.8503 30.468 38.1345 30.1692 38.3337 29.6155C41.685 20.3319 45.051 11.0571 48.4141 1.77936C48.4727 1.61824 48.5225 1.45712 48.5869 1.29892C48.9326 0.440578 49.5771 -0.034002 50.3388 0.00408158C51.1268 0.0450947 51.6951 0.534322 51.9705 1.45419C52.3191 2.62013 52.6443 3.79486 52.9841 4.96667C53.0251 5.10435 53.0749 5.23911 53.1658 5.50862C53.8073 4.80261 54.3874 4.16691 54.9674 3.53121C55.3219 3.14158 55.7232 2.83984 56.2681 2.79004C57.2378 2.70509 58.0199 3.38473 58.1283 4.44228C58.269 5.82501 58.4037 7.21067 58.5033 8.59632C58.5326 9.00938 58.7055 9.16758 59.0775 9.30233C61.1721 10.0552 62.5431 11.517 63.1583 13.6556C63.2726 14.0569 63.4718 14.2532 63.8467 14.3997C66.0907 15.2873 68.323 16.1984 70.5582 17.1095C72.0816 17.7305 72.3892 18.6973 71.5865 20.121C69.7907 23.3083 67.2479 25.605 63.7559 26.7886C62.1418 27.3334 60.4807 27.5561 58.7845 27.4038C58.2045 27.351 58.0434 27.5151 58.0463 28.101C58.0639 37.3026 58.061 46.5071 58.0522 55.7086C58.0522 56.151 58.1987 56.5055 58.4242 56.8629C61.5178 61.8342 64.6025 66.8056 67.6902 71.7799C67.8191 71.9879 67.9598 72.19 68.0682 72.4039C68.6921 73.6255 67.9656 74.9467 66.6005 74.976C64.5264 75.02 62.4523 74.9907 60.3753 74.9877C59.5784 74.9877 59.0951 74.5161 58.6849 73.8862C55.4947 68.9793 52.2928 64.0753 49.085 59.1801C48.9004 58.8989 48.8066 58.3481 48.3702 58.4858C47.9454 58.6176 48.1885 59.1186 48.1915 59.4438C48.2178 61.4563 47.8077 63.3722 46.9347 65.1797C46.6974 65.666 46.7677 65.8037 47.2862 65.9502C49.0498 66.4453 50.6347 67.2568 51.8943 68.6424C53.0515 69.9167 53.5876 71.4137 53.5964 73.1099C53.6022 74.2495 52.9431 74.9262 51.8035 74.9907C51.6336 74.9994 51.4608 74.9936 51.2909 74.9936C40.6978 74.9936 30.1018 74.9907 19.5087 74.9936C13.2483 74.9936 7.94882 72.7554 3.64245 68.203C2.27437 66.7587 1.1758 65.1211 0.285232 63.3429C-0.250868 62.2678 -0.0194364 61.2923 0.879922 60.8089C1.77928 60.3226 2.76359 60.6537 3.31141 61.7317C4.61211 64.2775 6.36982 66.4248 8.67241 68.118C12.223 70.7312 16.2335 71.7448 20.5926 71.5338C20.6482 71.5309 20.7068 71.4811 20.8357 71.4284Z"
        fill="#DADADA"
      />
    </svg>

    <button @click="uploadImageButton.click()">
      <icon-plus
        class="absolute bottom-0 bg-white border rounded-full text-primary border-primary right-2"
      />
    </button>

    <input @change="preview" type="file" ref="uploadImageButton" class="hidden" />
  </div>
</template>
